你说得完全正确！Docker配置应该在一键部署之前。以下是修正后的正确顺序：

# 产品安装与部署手册（Windows Docker版）

## 1. 系统要求

### 1.1 硬件要求
- CPU: 2核以上（需开启虚拟化）
- 内存: 4GB以上
- 存储: 20GB可用空间

### 1.2 软件要求
- **Windows 10/11**（64位）
- **Docker Desktop** 4.0+
- **Git Bash** 或 **WSL2**（推荐）

## 2. 环境准备

### 2.1 安装Docker Desktop
1. 下载 Docker Desktop：https://www.docker.com/products/docker-desktop/
2. 安装并重启电脑
3. 启用 WSL2 后端（设置 → General → Use WSL2 based engine）
4. 启动 Docker Desktop

### 2.2 验证安装
```powershell
docker --version
docker-compose --version
```

## 3. Docker配置

### 3.1 项目结构确认
```
项目根目录/
├── docker-compose.yml    # Docker编排文件
├── Dockerfile           # 应用镜像构建文件
├── scripts/             # 构建部署脚本
└── src/                 # 源代码
```

### 3.2 Docker Compose配置
**`docker-compose.yml` 示例：**
```yaml
version: '3.8'

services:
  # MySQL数据库服务
  mysql:
    image: mysql:8.0
    container_name: rjgcsj-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: shopdb
      MYSQL_USER: root
      MYSQL_PASSWORD: 123456
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  # Redis缓存服务
  redis:
    image: redis:7-alpine
    container_name: rjgcsj-redis
    ports:
      - "6379:6379"
    restart: unless-stopped

  # 后端应用服务
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: rjgcsj-backend
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=mysql
      - DB_PORT=3306
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
    restart: unless-stopped

volumes:
  mysql_data:version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=appdb
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:alpine
    ports:
      - "6379:6379"

volumes:
  mysql_data:version: '3.8'

services:
  # MySQL数据库服务
  mysql:
    image: mysql:8.0
    container_name: rjgcsj-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: rjgcsj_db
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  # Redis缓存服务
  redis:
    image: redis:7-alpine
    container_name: rjgcsj-redis
    ports:
      - "6379:6379"
    restart: unless-stopped

  # 后端应用服务
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: rjgcsj-backend
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=mysql
      - DB_PORT=3306
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
    restart: unless-stopped

volumes:
  mysql_data:version: '3.8'

services:
  # MySQL数据库服务
  mysql:
    image: mysql:8.0
    container_name: rjgcsj-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: rjgcsj_db
      MYSQL_USER: app_user
      MYSQL_PASSWORD: app123
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  # Redis缓存服务
  redis:
    image: redis:7-alpine
    container_name: rjgcsj-redis
    ports:
      - "6379:6379"
    restart: unless-stopped

  # 后端应用服务
  backend:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: rjgcsj-backend
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
      - DB_HOST=mysql
      - DB_PORT=3306
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
    restart: unless-stopped

volumes:
  mysql_data:
```

### 3.3 Dockerfile配置
**`Dockerfile` 示例：**
```dockerfile
FROM openjdk:11-jre-slim
WORKDIR /app
COPY target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

## 4. 项目配置

### 4.1 获取项目代码
```bash
# 克隆项目
git clone [项目地址]
cd [项目目录]

# 或使用现有项目
cd D:\project\rjgcsj
```

### 4.2 环境检查
```bash
# 运行环境检查脚本
.\scripts\env-check.ps1
```

### 4.3 应用配置
1. 复制配置文件：
```bash
copy config\application-example.properties config\application.properties
```

2. 修改数据库连接等配置以匹配Docker服务

## 5. 构建项目

### 5.1 构建应用
```bash
# 使用构建脚本
.\scripts\build.ps1

# 或手动构建
mvn clean package
```

### 5.2 构建Docker镜像
```bash
docker build -t myapp:latest .
```

## 6. 一键部署

### 6.1 启动所有服务
```bash
# 使用 Docker Compose 启动所有服务
docker-compose up -d
```

### 6.2 验证部署
```bash
# 检查服务状态
docker-compose ps

# 查看应用日志
docker-compose logs app

# 健康检查
curl http://localhost:8080/health
```

## 7. 脚本说明

### 7.1 完整部署脚本 [`scripts/deploy.ps1`](scripts/deploy.ps1)
```powershell
# 完整部署流程
Write-Host "1. 环境检查..."
.\scripts\env-check.ps1

Write-Host "2. 构建应用..."
mvn clean package

Write-Host "3. 构建Docker镜像..."
docker build -t myapp:latest .

Write-Host "4. 启动服务..."
docker-compose up -d

Write-Host "5. 健康检查..."
Start-Sleep -Seconds 30
curl http://localhost:8080/health
```

### 7.2 服务管理脚本 [`scripts/manage.ps1`](scripts/manage.ps1)
```powershell
# 服务管理功能
```

## 8. 访问应用

- **应用地址**: http://localhost:8080
- **API文档**: http://localhost:8080/swagger-ui.html

## 9. 运维管理

```bash
# 服务管理
docker-compose start    # 启动
docker-compose stop     # 停止  
docker-compose restart  # 重启

# 日志查看
docker-compose logs -f app

# 数据备份
docker-compose exec mysql mysqldump -u root -p appdb > backup.sql
```

**正确的逻辑顺序**：Docker配置 → 项目配置 → 构建项目 → 一键部署